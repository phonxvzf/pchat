<!DOCTYPE html>
<html>
<header>
    <title>pchat</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</header>

<body>
    <!--Home Page-->
    <div id="home" style="text-align: center; 
            border: darkslateblue;
            border-style: dashed;
            background-color:skyblue;
            padding-bottom: 20px;
            margin: 20mm;
            margin-left: 120mm;
            margin-right: 120mm">
        <h1 style="color:darkslateblue">Welcome to pchat</h1>

        <p>For existing user, please log in.</p>
        <table align="center">
            <tr>
                <td>User name:</td>
                <td><input id="UNLoginBox" type="text"></td>
            </tr>
            <tr>
                <td>Password:</td>
                <td><input id="PWLoginBox" type="password"></td>
            </tr>
        </table>
        <button onclick="Login()">Login</button><br>
        <button onclick="Forget()">Forget Password</button>
        <p id="LoginWarning" style="color:red"></p>

        <p>For new user, please create new account.</p>
        <table align="center">
            <tr>
                <td>User name:</td>
                <td><input id="UNRegBox" type="text"></td>
            </tr>
            <tr>
                <td>Password:</td>
                <td><input id="PWRegBox" type="password"></td>
            </tr>
            <tr>
                <td>Display name:</td>
                <td><input id="DNRegBox" type="text"></td>
            </tr>
        </table>
        <button onclick="Register()">Register</button>
        <p id="RegWarning" style="color:red"></p>

    </div>

    <!--Main Page-->
    <div id="main" style="display: none; margin: 20px">
        <button onclick="Logout()" style="float :right">Logout</button>
        <p id="UNMain">User name:</p>
        <p id="DNMain">Display name:</p>
        <p><u>My Group</u></p>

        <table id="myTable" border="1">
            <col width="100">
            <col width="300">
            <col width="200">
            <tr>
                <td>Group ID</td>
                <td>Group name</td>
                <td>Option</td>
            </tr>
        </table>

        <p><u>Join/Create new Group</u></p>

        <table>
            <tr>
                <td style="text-align:right">GroupID:</td>
                <td><input id="GIDBox" type="text"></td>
                <td style="text-align:left;"><button onclick="JoinGroup()">Join</button></td>
            </tr>
            <tr>
                <td>Group Name:</td>
                <td><input id="GNameBox" type="text"></td>
                <td><button onclick="CreteGroup()">Create</button></td>
            </tr>
        </table>

        <p id="test"></p>
    </div>

    <!--Group-->
    <div id="group" style="display:none;">
        <button onclick="Exit()" style="float :right">Exit</button>
        <p id="GID">Group id:</p>
        <p id="GName">Group name:</p>
        <table style="bottom: 10px; position: absolute;">
            <tr>
                <td>
                    <div style="width: 770px; height: 200px; position: relative; overflow: auto;">
                        <table id="chatroom" border="1" style="bottom: 0px; position:absolute;">
                            <col width="170">
                            <col width="100">
                            <col width="500">
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <table border="1">
                        <col width="170">
                        <col width="100">
                        <col width="500">
                        <tr>
                            <td>Time</td>
                            <td>Author</td>
                            <td>Message</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <input id="message" type="text" size="100">
                    <button onclick="Send()">Send</button>
                </td>
            </tr>
        </table>
    </div>

    <script>
        var username, password, displayname;
        var main = $("#main")[0];
        var home = $("#home")[0];
        var group = $("#group")[0];
        var grouplist = [];

        //Home Page Script//
        function Login() {
            username = $('#UNLoginBox')[0].value;
            password = $('#PWLoginBox')[0].value;
            displayname = "-";
            if ((username == "") || (password == "")) {
                $('#LoginWarning')[0].innerHTML = "Look like you doesn't enter username or password.";
            }
            else {
                //cname = <<<Get username from Database using CID>>;
                //document.getElementById("cnameMain").innerHTML = "Name: " + cname;
                $.post(
                    window.location.origin + '/login',
                    { login: 'username', password: 'password' },
                    function (disname) { displayname = disname; }
                );

                //And "GET" group list from backend as well. This is only a demo.
                //grouplist = ...
                toMainPage();
            }
        }
        function Register() {
            username = $('#UNRegBox')[0].value;
            password = $('#PWRegBox')[0].value;
            displayname = $("#DNRegBox")[0].value;
            if ((username == "") || (password == "") || (displayname == "")) {
                $('#RegWarning')[0].innerHTML = "Look like you doesn't enter username or password.";
            }
            else {
                $.post(
                    window.location.origin + '/register',
                    { login: 'username', name: 'displayname', password: 'password' },
                );
                toMainPage();
            }
        }
        function Forget() {
            $('#LoginWarning')[0].innerHTML = "Just create new ID. We will delete your account later.";
        }
        //End of Home Page Script//

        //Main Page Script//    
        function Logout() {
            $("#PWLoginBox")[0].value = "";
            $("#PWRegBox")[0].value = "";
            $("#DNRegBox")[0].value = "";
            $("#DNMain")[0].value = "";
            $("#UNMain")[0].innerHTML = "User name:";
            $("#DNMain")[0].innerHTML = "Display name:";
            toHomePage();
        }
        function JoinGroup() {
            var gid1 = $("#GIDBox")[0].value;
            var gname1 = "-";//Search Group Name from database.
            $("#GIDBox")[0].value = "";
            var newgroup = { gid: "" + gid1, gname: "" + gname1 };
            grouplist.push(newgroup);
            AddGroup(gid1, gname1);
        }
        function CreteGroup() {
            var gname1 = $("#GNameBox")[0].value;
            var gid1 = "-";//Generate new group ID from backend.
            $("#GNameBox")[0].value = "";
            var newgroup = { gid: "" + gid1, gname: "" + gname1 };
            grouplist.push(newgroup);
            AddGroup(gid1, gname1);
        }
        function AddGroup(newgid, newgname) {
            var table = $("#myTable")[0];
            var x = table.rows.length;
            var row = table.insertRow(x);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = newgid;
            cell2.innerHTML = newgname;
            cell3.innerHTML = "<button onclick='ViewGroup(this)' value=" + newgid + ">View</button>" +
                "<button onclick='LeaveGroup(this)' value=" + newgid + ">Leave</button>";
        }
        function LeaveGroup(btn) {
            var row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            for (i = 0; i < grouplist.length; i++) {
                if (grouplist[i]["gid"] === btn.value) {
                    var removed = grouplist.splice(i, 1);
                    $("#test")[0].innerHTML = "Leaving Group " + removed[0]["gname"];
                    break;
                }
            }
        }
        function ViewGroup(btn) {
            $("#test")[0].innerHTML = "Go to Group " + btn.value;
            toGroupPage(btn.value);
        }
        //End of Main Page Script//

        //Group Page Script//
        function Send() {
            $("#test")[0].innerHTML = "Sending... ";
            var table = $("#chatroom")[0];
            var x = table.rows.length;
            var row = table.insertRow(x);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = "<p style='color:red'>" + new Date().toLocaleString() + "</p>";
            cell2.innerHTML = "<p style='color:indigo'>" + displayname + "</p>";
            cell3.innerHTML = $("#message")[0].value;
            $("#message")[0].value = "";
        }
        function Exit() {
            toMainPage();
        }
        //End of Group Page Script//

        //Page Manage Script//
        function toMainPage() {
            var table = $("#myTable")[0];
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            for (i = 0; i < grouplist.length; i++) {
                AddGroup(grouplist[i]["gid"], grouplist[i]["gname"]);
            }
            $("#UNMain")[0].innerHTML = "User name: " + username;
            $("#DNMain")[0].innerHTML = "Display name: " + displayname;
            main.style.display = "block";
            home.style.display = "none";
            group.style.display = "none";
        }
        function toHomePage() {
            $("#UNLoginBox")[0].value = "";
            $("#UNRegBox")[0].value = "";
            $("#LoginWarning")[0].innerHTML = "";
            $("#RegWarning")[0].innerHTML = "";
            main.style.display = "none";
            home.style.display = "block";
            group.style.display = "none";
        }
        function toGroupPage(gid) {
            $("#GID")[0].innerHTML = "Group ID: " + gid;
            //$("#GName")[0].value = "Group name: " + gname;
            main.style.display = "none";
            home.style.display = "none";
            group.style.display = "block";
        }
        //End of Page Manage Script//
    </script>
</body>

</html>