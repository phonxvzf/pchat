<!DOCTYPE html>
<html>
<header>
    <title>pchat</title>
</header>

<body>
    <!--Home Page-->
    <div id="home" style="text-align: center; 
            border: darkslateblue;
            border-style: dashed;
            background-color:skyblue;
            padding-bottom: 20px;
            margin: 20mm;
            margin-left: 120mm;
            margin-right: 120mm">
        <h1 style="color:darkslateblue">Welcome to pchat</h1>

        <p>For existing user, please log in.</p>
        ClientID: <input id="CIDBox" type="text">
        <button onclick="Login()">Login</button>
        <p id="CIDWarning" style="color:red"></p>

        <p>For new user, please create new account.</p>
        Your name: <input id="CNameBox" type="text">
        <button onclick="Register()">Register</button>
        <p id="CNameWarning" style="color:red"></p>

    </div>

    <!--Main Page-->
    <div id="main" style="display: none; margin: 20px">
        <p id="cnameMain">Name:</p>
        <button onclick="Logout()" style="float :right">Logout</button>
        <p id="cidMain">CID:</p>
        <p><u>My Group</u></p>

        <table id="myTable">
            <col width="100">
            <col width="300">
            <col width="200">
            <tr>
                <td>Group ID</td>
                <td>Group name</td>
                <td>Option</td>
            </tr>
        </table>

        <p><u>Join/Create new Group</u></p>

        <table>
            <tr>
                <td style="text-align:right">GroupID:</td>
                <td><input id="GIDBox" type="text"></td>
                <td style="text-align:left;"><button onclick="JoinGroup()">Join</button></td>
            </tr>
            <tr>
                <td>Group Name:</td>
                <td><input id="GNameBox" type="text"></td>
                <td><button onclick="CreteGroup()">Create</button></td>
            </tr>
        </table>

        <p id="test"></p>
    </div>

    <script>
        var cid, cname;
        var main = document.getElementById("main");
        var home = document.getElementById("home");
        var group = document.getElementById("group");
        var grouplist = [];

        //Home Page Script//
        function Login() {
            cid = document.getElementById("CIDBox").value;
            if ((cid == "")) {
                document.getElementById("CIDWarning").innerHTML = "Please input a CID.";
            }
            else {
                document.getElementById("cidMain").innerHTML = "CID: " + cid;
                //cname = <<<Get username from Database using CID>>;
                //document.getElementById("cnameMain").innerHTML = "Name: " + cname;

                //And "GET" group list from backend as well. This is only a demo.
                toMainPage();
            }
        }
        function Register() {
            cname = document.getElementById("CNameBox").value;
            if ((cname == "")) {
                document.getElementById("CNameWarning").innerHTML = "Please input a name.";
            }
            else {
                document.getElementById("cnameMain").innerHTML = "Name: " + cname;

                //cid = <<<Generate cid for new user>>>;
                //document.getElementById("cidMain").innerHTML = "CID: " + cid;
                toMainPage();
            }
        }
        //End of Home Page Script//

        //Main Page Script//    
        function Logout() {
            cid = "";
            cname = "";
            document.getElementById("cidMain").innerHTML = "CID: " + cid;
            document.getElementById("cnameMain").innerHTML = "Name: " + cname;
            toHomePage();
        }
        function JoinGroup() {
            var gid1 = document.getElementById("GIDBox").value;
            var gname1 = "-";//Search Group Name from database.
            document.getElementById("GIDBox").value = "";
            var newgroup = { gid: "" + gid1, gname: "" + gname1 };
            grouplist.push(newgroup);
            AddGroup(gid1, gname1);
        }
        function CreteGroup() {
            var gname1 = document.getElementById("GNameBox").value;
            var gid1 = "-";//Generate new group ID from backend.
            document.getElementById("GNameBox").value = "";
            var newgroup = { gid: "" + gid1, gname: "" + gname1 };
            grouplist.push(newgroup);
            AddGroup(gid1, gname1);
        }
        function AddGroup(newgid, newgname) {
            var table = document.getElementById("myTable");
            var x = table.rows.length;
            var row = table.insertRow(x);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = newgid;
            cell2.innerHTML = newgname;
            cell3.innerHTML = "<button onclick='ViewGroup(this)' value=" + newgid + ">View</button>" +
                "<button onclick='LeaveGroup(this)' value=" + newgid + ">Leave</button>";
        }
        function LeaveGroup(btn) {
            var row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            for (i = 0; i < grouplist.length; i++) {
                if (grouplist[i]["gid"] === btn.value) {
                    var removed = grouplist.splice(i, 1);
                    document.getElementById("test").innerHTML = "Leaving Group " + removed[0]["gname"];
                    break;
                }
            }
        }
        function ViewGroup(btn) {
            document.getElementById("test").innerHTML = "Go to Group " + btn.value;
        }
        //End of Main Page Script//

        //Group Page Script//
        //End of Group Page Script//

        //Page Manage Script//
        function toMainPage() {
            var table = document.getElementById("myTable");
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            for (i = 0; i < grouplist.length; i++) {
                AddGroup(grouplist[i]["gid"], grouplist[i]["gname"]);
            }
            main.style.display = "block";
            home.style.display = "none";
            group.style.display = "none";
        }
        function toHomePage() {
            document.getElementById("CIDBox").value = "";
            document.getElementById("CNameBox").value = "";
            document.getElementById("CNameWarning").innerHTML = "";
            document.getElementById("CIDWarning").innerHTML = "";
            main.style.display = "none";
            home.style.display = "block";
            group.style.display = "none";
        }
        function toGroupPage() {
            main.style.display = "none";
            home.style.display = "none";
            group.style.display = "block";
        }
        //End of Page Manage Script//
    </script>
</body>

</html>